<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Siedler‑Mini v11.1r6</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Basis‑Styles zuerst, plattformspezifische danach, App-Styles am Ende -->
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/platform.css" />
  <link rel="stylesheet" href="css/android.css" />
  <link rel="stylesheet" href="css/ios.css" />
  <link rel="stylesheet" href="css/desktop.css" />
  <link rel="stylesheet" href="css/mobile.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* HUD fixiert (zoomt nicht mit dem Canvas) */
    :root { --panel: rgba(10,16,24,.82); --bd: rgba(255,255,255,.08); --txt:#e6f0ff; }
    html,body { height:100%; margin:0; background:#0b1a26; color:var(--txt); }
    #stage { position:fixed; inset:0; display:block; width:100%; height:100%; image-rendering:pixelated; touch-action:none; }
    #debugOverlay { position:fixed; left:16px; top:max(12px, env(safe-area-inset-top)); z-index:1001; display:none;
      min-width:260px; white-space:pre; padding:10px 12px; border-radius:12px; background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.08); backdrop-filter:blur(6px); font:13px/1.35 ui-monospace,Menlo,Consolas,monospace; }
    body.debug-on #debugOverlay { display:block; }
    #hud { position:fixed; left:max(10px, env(safe-area-inset-left)); bottom:max(10px, env(safe-area-inset-bottom));
      z-index:1000; display:flex; flex-wrap:wrap; gap:10px; align-items:center; background:var(--panel);
      border:1px solid var(--bd); border-radius:14px; padding:10px 12px; box-shadow:0 10px 40px rgba(0,0,0,.35);
      max-width:calc(100vw - 20px - env(safe-area-inset-left) - env(safe-area-inset-right)); }
    #hud .grp { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    #hud button, #hud select, #hud label { font:inherit; color:var(--txt); }
    #hud button { background:#18314a; border:1px solid var(--bd); border-radius:10px; padding:8px 12px; cursor:pointer; }
    #hud button.ok { background:#1fb06a; color:#06220f; border-color:rgba(0,0,0,.2); }
    #hud select { background:#102334; border:1px solid var(--bd); border-radius:10px; padding:8px 10px; min-width:240px; }
    #badge { padding:5px 10px; border-radius:999px; background:#102336; border:1px solid var(--bd); font:12px ui-monospace,Menlo,Consolas; }
  </style>
</head>
<body>

  <!-- Zeichenfläche -->
  <canvas id="stage"></canvas>
  <!-- Debug Overlay (wird von debug.js & boot.js benutzt) -->
  <pre id="debugOverlay"></pre>

  <!-- HUD / Toolbar -->
  <div id="hud" role="toolbar" aria-label="Spielsteuerung">
    <span id="badge">V? • ?</span>
    <div class="grp">
      <button id="btnStart" class="ok">Start</button>
      <button id="btnReload">Neu laden</button>
    </div>
    <div class="grp">
      <label for="mapSelect">Karte:</label>
      <select id="mapSelect">
        <!-- Fallback-Optionen; werden von boot.js ausgefüllt/überschrieben -->
        <option value="assets/maps/map-demo.json">map-demo.json</option>
        <option value="assets/maps/map-pro.json">map-pro.json</option>
        <option value="assets/maps/map-test-all.json">map-test-all.json</option>
        <option value="maps/start-map.json">start-map.json</option>
      </select>
      <label><input id="autoStart" type="checkbox" /> Auto‑Start</label>
    </div>
    <div class="grp">
      <button id="btnDebug"      title="Debug an/aus (F2)">Debug</button>
      <button id="btnSaveDebug"  title="Debug-Log als TXT speichern">Debug speichern</button>
      <button id="btnFullscreen" title="Vollbild umschalten">Vollbild</button>
    </div>
  </div>

  <!-- ========= Skripte =========
       Reihenfolge: Core → Helpers → Game‑Subsysteme → App/Main → Tools → Boot
  -->

  <!-- Core -->
  <script src="core/asset.js"></script>
  <script src="core/asset.items.js"></script>
  <script src="core/camera.js"></script>
  <script src="core/terrain.js"></script>
  <script src="core/actor.js"></script>
  <script src="core/carriers.js"></script>

  <!-- Helpers / Service / Debug -->
  <script src="storage.js"></script>
  <script src="fullscreen.js"></script>
  <script src="debug.js"></script>
  <script src="tools/debug-tools.js"></script>
  <script src="tools/dev-inspector.js"></script>

  <!-- Game-Subsysteme -->
  <script src="textures.js"></script>
  <script src="unitLogic.js"></script>
  <script src="render.js"></script>
  <script src="world.js"></script>
  <script src="input.js"></script>

  <!-- App / Main / Runtime -->
  <script src="app-v11.1r6.js"></script>
  <script src="main.js"></script>
  <script src="js/characters.js"></script>
  <script src="js/ui.js"></script>
  <script src="game.js"></script>

  <!-- Boot zuletzt (HUD-Wiring, Version/Cachebust, Autostart) -->
  <script src="boot.js"></script>

  <!-- (Optional) Service Worker registrieren -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
