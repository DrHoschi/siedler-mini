<!doctype html>
<html lang="de">
<head>
  <!-- =========================================
       Siedler‑Mini • index.html
       Zweck: Startfenster (Zustand A), HUD, Inspector
       ========================================= -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Siedler‑Mini</title>

  <!-- ====== STYLES (kompakt, aktuelles Farbschema) ====== -->
  <style>
    :root{ --bg:#0b0d10; --stage:#161a20; --panel:#0f1318; --b1:#2a2f38; --b2:#39414d; --fg:#e8e8e8; --muted:#b9c4d1; }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    #stage{display:block;width:100vw;height:100vh;background:var(--stage)}
    #hud{position:fixed;top:8px;left:8px;right:8px;z-index:20;display:flex;gap:8px;align-items:center;flex-wrap:wrap;background:rgba(0,0,0,.35);backdrop-filter:blur(4px);padding:8px 10px;border-radius:8px}
    #hud .spacer{flex:1 1 auto}
    button{padding:6px 10px;border-radius:8px;border:1px solid var(--b2);background:#1a2029;color:var(--fg);cursor:pointer}
    button:hover{background:#222a35}
    button:disabled{opacity:.5;cursor:not-allowed}
    select{background:#121821;color:var(--fg);border:1px solid var(--b2);border-radius:8px;padding:6px 8px}
    #startPanel{position:fixed;inset:0;z-index:30;display:grid;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.85))}
    #startPanel .panel{width:min(720px,92vw);background:var(--panel);border:1px solid var(--b1);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.6);padding:18px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    h1{margin:0 0 8px}
    p.sub{margin:0 0 14px;opacity:.85}
    #quickDiag{margin-top:10px;padding:10px;background:#0b0f14;border:1px dashed #2b3340;border-radius:8px;color:var(--muted);max-height:30vh;overflow:auto;white-space:pre-wrap}
    #inspectorBar{position:fixed;left:8px;right:8px;bottom:8px;z-index:25;display:flex;justify-content:space-between;gap:8px;background:rgba(0,0,0,.35);backdrop-filter:blur(4px);padding:6px 8px;border-radius:8px}
    #inspector{position:fixed;inset:4% 4% auto 4%;bottom:4%;z-index:40;background:var(--panel);border:1px solid var(--b1);border-radius:12px;display:flex;flex-direction:column}
    #inspector[hidden]{display:none}
    #inspector header{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--b1)}
    #inspector .tabs{display:flex;gap:8px;padding:8px 10px;border-bottom:1px solid var(--b1)}
    #inspector .content{flex:1 1 auto;overflow:auto;padding:10px}
    .hide{display:none!important}
    /* Logo im Startscreen */
    #startPanel::before{
      content:""; position:absolute; inset:0; z-index:-1;
      background:url("./assets/ui/logo.png") center/40% no-repeat; opacity:.12; filter:blur(0.2px);
    }
  </style>

  <!-- Feature-Flag Fullscreen → iPhone blendet Button später aus -->
  <script>
    (function(){
      const isIPhone = /iPhone/i.test(navigator.userAgent);
      const canFS = !!(document.documentElement.requestFullscreen||document.documentElement.webkitRequestFullscreen||document.documentElement.msRequestFullscreen);
      if (isIPhone || !canFS) document.documentElement.classList.add('no-fs');
    })();
  </script>
</head>

<body>
  <!-- ===================== HUD ===================== -->
  <div id="hud" aria-label="Spiel‑HUD">
    <strong id="buildBadge" title="Build/Version">Siedler‑Mini</strong>
    <span class="spacer"></span>
    <button id="btnFull" title="Vollbild umschalten">Vollbild</button>
  </div>

  <!-- ===================== Bühne ===================== -->
  <canvas id="stage"></canvas>

  <!-- ===================== Start-Overlay (Zustand A) ===================== -->
  <section id="startPanel">
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="t">
      <h1 id="t">Siedler‑Mini</h1>
      <p class="sub">Wähle eine Karte und starte das Spiel.</p>

      <div class="row">
        <label for="mapSelect">Karte:</label>
        <select id="mapSelect">
          <option value="./assets/maps/map-demo.json">map-demo.json</option>
          <option value="./assets/maps/map-pro.json">map-pro.json</option>
          <option value="./assets/maps/map-test-all.json">map-test-all.json</option>
        </select>
      </div>

      <div class="row">
        <button id="btnStart">Neues Spiel</button>
        <button id="btnContinue" disabled>Weiterspielen</button>
        <button id="btnReset">Reset</button>
      </div>

      <pre id="quickDiag" aria-live="polite"></pre>
    </div>
  </section>

  <!-- ===================== Untere Toast-Leiste ===================== -->
  <div id="inspectorBar" class="toast" aria-live="polite">
    <button id="btnInspector" title="Inspector öffnen">Inspector öffnen</button>
    <button id="btnCacheClear" title="Seite neu laden und Cache umgehen">Cache leeren</button>
  </div>

  <!-- ===================== Inspector ===================== -->
  <aside id="inspector" hidden>
    <header>
      <strong>Inspector</strong>
      <button id="btnInspectorClose" title="Schließen">Close</button>
    </header>
    <div class="tabs">
      <button data-tab="debug">Debug</button>
    </div>
    <div class="content" id="inspectorContent"></div>
  </aside>

  <!-- ===================================================================
       ⬇⬇⬇  S C R I P T   P I P E L I N E  (ORDER MATTERS)  ⬇⬇⬇
       Lege DEINE Skripte hier unten ab – *vor* </body>. Die Reihenfolge
       ist wichtig, damit Abhängigkeiten stimmen.
       -------------------------------------------------------------------
       1) VENDOR / POLYFILLS (optional)
          → Beispiel: Tiled-Parser, EventEmitter, Promise polyfill
          <script src="./vendor/some-polyfill.js" defer></script>

       2) CORE (Assets, Konstanten, Datendefinitionen)
          → Muss vor Game‑Systemen geladen werden.
          <script src="./core/asset.js" defer></script>
          <script src="./core/asset.items.js" defer></script>

       3) GAME‑SYSTEME / MODULE
          → Rendering, Map‑Runtime, Kamera, Entities, UI‑Helpers etc.
          Beispiele/Platzhalter:
          <script src="./tools/map-runtime.js" defer></script>
          <script src="./entities/worker.js" defer></script>
          <script src="./entities/fisherman.js" defer></script>

       4) GAMELOADER / SPIELKERN
          → Stellt window.GameLoader.start(..) & .continueFrom(..) bereit.
          <script src="./game.js" defer></script>

       5) BOOT / VERDRAHTUNG
          → Verdrahtet DOM, Startfenster, Inspector, Cache-Leeren, FS‑Toggle.
          <script src="./boot.js" defer></script>
       =================================================================== -->

  <!-- ===== [2] CORE ===== -->
  <script src="./core/asset.js" defer></script>
  <script src="./core/asset.items.js" defer></script>

  <!-- ===== [3] GAME‑SYSTEME (Beispiele – optional, falls vorhanden) ===== -->
  <!-- <script src="./tools/map-runtime.js" defer></script> -->
  <!-- <script src="./entities/worker.js" defer></script> -->
  <!-- <script src="./entities/fisherman.js" defer></script> -->

  <!-- ===== [4] GAMELOADER ===== -->
  <script src="./game.js" defer></script>

  <!-- ===== [5] BOOT ===== -->
  <script src="./boot.js" defer></script>

  <!-- Fullscreen-Button ggf. ausblenden (Flag aus <head>) -->
  <script>
    (function(){
      if (document.documentElement.classList.contains('no-fs')) {
        const fsBtn = document.getElementById('btnFull');
        if (fsBtn) fsBtn.classList.add('hide');
      }
    })();
  </script>
</body>
</html>
