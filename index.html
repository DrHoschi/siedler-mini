<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>Siedlerâ€‘Mini V13 (Mobile)</title>
  <meta name="theme-color" content="#0b1220"/>

  <style>
    :root { --bg:#0b1220; --panel:#121a2a; --text:#d7e1f8; --muted:#93a2be; --accent:#4cc38a; }
    html,body { margin:0; height:100%; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    #ui-bar { position:fixed; inset:0 0 auto 0; display:flex; gap:.5rem; padding:.5rem .75rem; align-items:center; z-index:10; pointer-events:none; }
    #ui-bar .pill { pointer-events:auto; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
                    border-radius:999px; padding:.35rem .6rem; font-size:.9rem; }
    #left-tools { position:fixed; left:.5rem; top:3.75rem; display:flex; flex-direction:column; gap:.5rem; z-index:11; }
    .tool-btn { background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
                color:var(--text); border-radius:999px; padding:.45rem .9rem; font-size:.9rem; }
    .tool-btn.active { outline:2px solid var(--accent); }

    #canvas { position:fixed; inset:0; touch-action:none; background:transparent; z-index:1; }

    /* Start-Overlay */
    #overlay { position:fixed; inset:0; display:grid; place-items:center; z-index:20;
               background:linear-gradient(180deg, rgba(4,8,16,.92), rgba(4,8,16,.92)); }
    #card { background:var(--panel); border:1px solid rgba(255,255,255,.09); border-radius:16px;
            padding:20px 22px; width:min(680px,92vw); box-shadow: 0 18px 40px rgba(0,0,0,.35); }
    #card h1 { font-size:1.25rem; margin:.25rem 0 .5rem; }
    #card p { color:var(--muted); margin:.25rem 0; line-height:1.4; }
    #card .row { display:flex; gap:.5rem; margin-top:.75rem; }
    .btn { background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.1);
           color:var(--text); padding:.5rem .9rem; border-radius:10px; }
    .btn.primary { background:var(--accent); color:#04110a; border:none; }

    /* Debug-Pill rechts */
    #dbg { position:fixed; right:.5rem; top:.5rem; display:flex; gap:.5rem; z-index:12; }
    #dbg .pill { background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
                 border-radius:999px; padding:.35rem .6rem; font-size:.9rem; }

    /* â€Zentrierenâ€œ-Button */
    #centerBtn { position:fixed; right:.5rem; top:3.2rem; z-index:12; }
  </style>
</head>
<body>

  <!-- Oberleiste (Ressourcen + kleine Helfer) -->
  <div id="ui-bar">
    <span class="pill" id="r-wood">ğŸŒ² Holz 0</span>
    <span class="pill" id="r-stone">ğŸª¨ Stein 0</span>
    <span class="pill" id="r-food">ğŸŒ¿ Nahrung 0</span>
    <span class="pill" id="r-gold">âšªï¸ Gold 0</span>
    <span class="pill" id="r-car">ğŸ§º TrÃ¤ger 0</span>
  </div>

  <!-- linke Tool-Leiste -->
  <div id="left-tools">
    <button class="tool-btn" data-tool="pointer">Zeiger</button>
    <button class="tool-btn" data-tool="road">StraÃŸe</button>
    <button class="tool-btn" data-tool="hq">HQ</button>
    <button class="tool-btn" data-tool="lumber">HolzfÃ¤ller</button>
    <button class="tool-btn" data-tool="depot">Depot</button>
    <button class="tool-btn" data-tool="bulldoze">Abriss</button>
  </div>

  <div id="dbg">
    <span class="pill" id="toolLabel">Tool: Zeiger</span>
    <span class="pill" id="zoomLabel">Zoom 1.00Ã—</span>
  </div>
  <button id="centerBtn" class="pill">Zentrieren</button>

  <!-- Spiel-Canvas -->
  <canvas id="canvas"></canvas>

  <!-- Start-Overlay -->
  <div id="overlay">
    <div id="card">
      <h1>Siedlerâ€‘Mini V13 (Mobile)</h1>
      <p>1 Finger = Karte verschieben (nur im <em>Zeigerâ€‘Tool</em>) Â· 2 Finger = Zoomen Â· kurzer Tap = bauen (wenn ein Bauâ€‘Tool aktiv ist).</p>
      <p>Das erste HQ (Stein) ist mittig gesetzt. Fehlende Texturen werden als Platzhalter dargestellt.</p>
      <div class="row">
        <button id="startBtn" class="btn primary">Start</button>
        <button id="fsBtn" class="btn">Vollbild</button>
      </div>
      <p style="margin-top:.5rem;">Tipp: Doppeltipp auf diese Karte schaltet Vollbild.</p>
    </div>
  </div>

  <!-- Hauptmodul direkt laden -->
  <script type="module">
    import * as Game from './main.js?v=13.8.2';

    // expose fÃ¼r Buttons
    window.__Game = Game;

    const startBtn = document.getElementById('startBtn');
    const fsBtn    = document.getElementById('fsBtn');
    const overlay  = document.getElementById('overlay');
    const card     = document.getElementById('card');

    // Start
    startBtn.addEventListener('click', () => {
      overlay.style.display = 'none';
      Game.start();
    });

    // Vollbild
    fsBtn.addEventListener('click', () => Game.toggleFullscreen());

    // Doppeltipp auf Karte => Vollbild
    card.addEventListener('dblclick', (e) => {
      e.preventDefault();
      Game.toggleFullscreen();
    }, { passive:false });

    // Tool-Buttons (linke Spalte)
    document.querySelectorAll('#left-tools .tool-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('#left-tools .tool-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tool = btn.dataset.tool;
        document.getElementById('toolLabel').textContent = 'Tool: ' + (tool==='pointer'?'Zeiger':
                                                                         tool==='road'?'StraÃŸe':
                                                                         tool==='hq'?'HQ':
                                                                         tool==='lumber'?'HolzfÃ¤ller':
                                                                         tool==='depot'?'Depot':'Abriss');
        Game.setTool(tool);
      });
    });

    // â€Zentrierenâ€œ
    document.getElementById('centerBtn').addEventListener('click', ()=>Game.centerOnHQ());

    // HUD Labels von Game updaten lassen
    Game.onHud((hud)=>{
      document.getElementById('r-wood').textContent = `ğŸŒ² Holz ${hud.wood}`;
      document.getElementById('r-stone').textContent = `ğŸª¨ Stein ${hud.stone}`;
      document.getElementById('r-food').textContent  = `ğŸŒ¿ Nahrung ${hud.food}`;
      document.getElementById('r-gold').textContent  = `âšªï¸ Gold ${hud.gold}`;
      document.getElementById('r-car').textContent   = `ğŸ§º TrÃ¤ger ${hud.carriers}`;
      document.getElementById('zoomLabel').textContent = `Zoom ${hud.zoom.toFixed(2)}Ã—`;
    });

    // beim Laden: Zeiger-Tool markieren
    document.querySelector('#left-tools .tool-btn[data-tool="pointer"]').classList.add('active');
  </script>
</body>
</html>
