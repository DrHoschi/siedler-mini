<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Siedler‑Mini v11.1r6</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Basis-Styles (deine vorhandenen Dateien) -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/platform.css" />
  <link rel="stylesheet" href="css/android.css" />
  <link rel="stylesheet" href="css/ios.css" />
  <link rel="stylesheet" href="css/desktop.css" />
  <link rel="stylesheet" href="css/mobile.css" />

  <style>
    /* Fixes: Canvas füllt Viewport; HUD/Toolbar bleiben fix (zoomen NICHT mit) */
    html, body { height: 100%; margin: 0; background: #0c1a25; color: #e8f2ff; }
    #stage { position: fixed; inset: 0; width: 100%; height: 100%; display: block; image-rendering: pixelated; }

    /* Startscreen & Toolbar (fixiert) */
    #startScreen {
      position: fixed; inset: 0; display: grid; place-items: center;
      background: radial-gradient(1200px 900px at 50% 40%, rgba(255,255,255,.06), transparent 60%) #0c1a25;
      z-index: 1000;
    }
    .start-card {
      background: rgba(10,16,24,.82); border: 1px solid rgba(255,255,255,.07);
      border-radius: 14px; padding: 16px 18px; box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
    }
    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; }
    .row > * { flex: 0 0 auto; }

    .btn { border: 1px solid rgba(255,255,255,.12); background:#1c2c44; color:#e8f2ff;
           border-radius: 12px; padding: 10px 14px; cursor: pointer; }
    .btn.ok { background:#1fb06a; color:#062411; border-color: rgba(0,0,0,.2); }
    .btn.alt { background:#24314a; }
    select, label.switch {
      background:#0f1b2d; color:#e8f2ff; border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:10px 12px; min-width: 240px;
    }
    label.switch { display: inline-flex; align-items: center; gap: 8px; }

    /* Debug-Overlay (wird von debug.js / tools/debug-tools.js genutzt) */
    #debugOverlay { position: fixed; left: 16px; top: 16px; z-index: 1100; display: none;
      background: rgba(0,0,0,.40); border: 1px solid rgba(255,255,255,.1); border-radius: 12px;
      padding: 10px 12px; white-space: pre; font: 13px/1.35 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    body.debug-on #debugOverlay { display: block; }

    /* Toolbar unten (fix) */
    #toolbar {
      position: fixed; left: 12px; right: 12px; bottom: max(12px, env(safe-area-inset-bottom, 0px) + 12px);
      z-index: 1050; pointer-events: none;
    }
    .toolbar-card {
      pointer-events: auto;
      background: rgba(10,16,24,.82); border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px; padding: 10px 12px; box-shadow: 0 10px 32px rgba(0,0,0,.35);
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center;
    }
  </style>
</head>
<body>

  <!-- Zeichenfläche -->
  <canvas id="stage"></canvas>

  <!-- Debug Overlay (Text wird von debug.js gesetzt) -->
  <pre id="debugOverlay"></pre>

  <!-- Start-Screen -->
  <div id="startScreen" aria-modal="true" role="dialog">
    <div class="start-card">
      <div class="row" style="justify-content: center; margin-bottom: 10px;">
        <h1 style="margin: 0 0 6px 0;">Siedler‑Mini</h1>
      </div>
      <div class="row" style="margin-bottom: 8px;">
        <label for="mapSelect">Karte:</label>
        <select id="mapSelect">
          <option value="assets/maps/map-demo.json">map-demo.json</option>
          <option value="assets/maps/map-pro.json">map-pro.json</option>
          <option value="assets/maps/map-test-all.json">map-test-all.json</option>
          <option value="maps/start-map.json">start-map.json</option>
        </select>
        <label class="switch"><input id="autoStart" type="checkbox" /> Auto‑Start</label>
      </div>
      <div class="row">
        <button id="btnStart" class="btn ok">Start</button>
        <button id="btnReload" class="btn alt">Neu laden</button>
        <button id="btnFullscreen" class="btn alt">Vollbild</button>
        <button id="btnDebug" class="btn alt" title="Debug an/aus (F2)">Debug</button>
        <button id="saveDebugBtn" class="btn alt" title="Debug‑Log speichern">Debug speichern</button>
      </div>
    </div>
  </div>

  <!-- Toolbar unten (fix, bleibt sichtbar beim Spielen) -->
  <div id="toolbar">
    <div class="toolbar-card">
      <span id="badge" style="font:600 12px ui-monospace,Menlo,Consolas">V? • ?</span>
      <button id="tbStart" class="btn ok">Start</button>
      <button id="tbReload" class="btn alt">Neu laden</button>
      <button id="tbFS" class="btn alt">Vollbild</button>
      <button id="tbDbg" class="btn alt">Debug</button>
      <button id="tbSave" class="btn alt">Debug speichern</button>
    </div>
  </div>

  <!-- Reihenfolge: Boot zuerst, dann App/Game/Main, dann Module/Utils, dann Tools -->
  <script>
    // Sichtbare Build/Boost-ID (auch für Cachebusting nutzbar)
    window.BUILD_ID = (window.BUILD_ID || "v11.1r6") + "-" + new Date().toISOString().slice(0,10);
  </script>

  <!-- Kern -->
  <script src="boot.js" defer></script>
  <script src="app-v11.1r6.js" defer></script>
  <script src="game.js" defer></script>
  <script src="main.js" defer></script>

  <!-- Module/Libs (deine bestehenden Dateien) -->
  <script src="buildingData.js" defer></script>
  <script src="world.js" defer></script>
  <script src="render.js" defer></script>
  <script src="unitLogic.js" defer></script>
  <script src="textures.js" defer></script>
  <script src="input.js" defer></script>
  <script src="storage.js" defer></script>

  <!-- Utilities -->
  <script src="fullscreen.js" defer></script>
  <script src="debug.js" defer></script>

  <!-- Dev/Debug Tools -->
  <script src="tools/debug-tools.js" defer></script>
  <script src="tools/dev-inspector.js" defer></script>

  <!-- Service Worker (optional – wenn vorhanden) -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
  </script>
  <script>
/* Debug-Bridge: sorgt dafür, dass setDebug/Overlay immer funktionieren */
(() => {
  const el = document.getElementById('debugOverlay') || (() => {
    const p = document.createElement('pre');
    p.id = 'debugOverlay';
    p.style.position = 'fixed';
    p.style.left = '16px';
    p.style.top = '16px';
    p.style.zIndex = '1100';
    p.style.background = 'rgba(0,0,0,.40)';
    p.style.border = '1px solid rgba(255,255,255,.1)';
    p.style.borderRadius = '12px';
    p.style.padding = '10px 12px';
    p.style.whiteSpace = 'pre';
    p.style.font = '13px/1.35 ui-monospace,Menlo,Consolas,monospace';
    p.style.display = 'none';
    document.body.appendChild(p);
    return p;
  })();

  if (!window.setDebug) {
    window.setDebug = (txt) => {
      if (!txt) { el.style.display = 'none'; el.textContent = ''; return; }
      el.style.display = 'block';
      // Wenn body.debug-on vorhanden -> immer zeigen, sonst nur initiale Meldung
      if (!document.body.classList.contains('debug-on')) document.body.classList.add('debug-on');
      el.textContent = String(txt);
    };
    console.log('[debug-bridge] setDebug bereit');
  }
})();
</script>
</body>
</html>
